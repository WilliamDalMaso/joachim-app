(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{3930:(e,t,s)=>{Promise.resolve().then(s.bind(s,9739))},9739:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>A});var n=s(5155),a=s(1934),l=s(2115),r=s(4416),i=s(4783),o=s(1366),c=s(5040),d=s(381),h=s(2486),u=s(9588);let m=()=>{let[e,t]=(0,l.useState)(!1),[s,n]=(0,l.useState)(!1),[a,r]=(0,l.useState)(!1),[i,o]=(0,l.useState)(""),[c,d]=(0,l.useState)(null),[h,u]=(0,l.useState)(!1),[m,x]=(0,l.useState)(!1),[p,g]=(0,l.useState)(!1),b=(0,l.useRef)(null),f=(0,l.useRef)(null),w=(0,l.useRef)(null),v=(0,l.useRef)(null),j=(0,l.useRef)(null),N=(0,l.useCallback)(async()=>{if(p&&v.current)return console.log("Microphone permission already granted"),v.current;try{console.log("Requesting microphone permission...");let e=await navigator.mediaDevices.getUserMedia({audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0}});v.current=e;let t=e.getAudioTracks()[0];return j.current=t,t.enabled=!1,g(!0),console.log("Microphone permission granted (initially disabled)"),e}catch(e){throw console.error("Microphone permission denied:",e),d("Microphone permission is required for voice conversation"),e}},[p]),y=(0,l.useCallback)(async()=>{if(e||h)return void console.log("Already connected or connecting, skipping...");try{u(!0),d(null),console.log("Starting connection to OpenAI Realtime API..."),console.log("Fetching ephemeral token...");let e=await fetch("".concat("http://localhost:3001","/session"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({model:"gpt-4o-mini-realtime-preview-2024-12-17",voice:"verse",instructions:"You are Joachim, an English language learning assistant. You must always speak in English, but you can also understand and respond to Portuguese if the user speaks Portuguese. Your primary goal is to help users improve their English skills through conversation. Be friendly, encouraging, and provide helpful corrections when needed."})});if(!e.ok){let t=await e.text();throw console.error("Token fetch failed:",e.status,t),Error("Failed to get session token: ".concat(e.status," - ").concat(t))}let s=(await e.json()).client_secret.value;console.log("Ephemeral token received"),console.log("Creating WebRTC peer connection...");let n=new RTCPeerConnection;b.current=n;let a=document.createElement("audio");a.autoplay=!0,a.style.display="none",document.body.appendChild(a),w.current=a,n.ontrack=e=>{console.log("Received remote audio track"),a.srcObject=e.streams[0]},console.log("Requesting microphone access...");let l=await N(),r=l.getAudioTracks()[0];j.current=r,r.enabled=!1,console.log("Microphone access granted (initially disabled)"),l.getTracks().forEach(e=>{n.addTrack(e,l)}),console.log("Setting up data channel...");let i=n.createDataChannel("oai-events");f.current=i,i.addEventListener("open",()=>{console.log("Data channel opened successfully")}),i.addEventListener("error",e=>{console.error("Data channel error:",e),d("Data channel error occurred")}),i.addEventListener("close",()=>{console.log("Data channel closed")}),i.addEventListener("message",e=>{try{let t=JSON.parse(e.data);S(t)}catch(e){console.error("Error parsing server event:",e)}}),console.log("Creating WebRTC offer...");let o=await n.createOffer();await n.setLocalDescription(o),console.log("Sending offer to OpenAI...");let c=await fetch("".concat("https://api.openai.com/v1/realtime","?model=").concat("gpt-4o-mini-realtime-preview-2024-12-17"),{method:"POST",body:o.sdp,headers:{Authorization:"Bearer ".concat(s),"Content-Type":"application/sdp"}});if(!c.ok){let e=await c.text();throw console.error("OpenAI WebRTC connection failed:",c.status,e),Error("Failed to establish WebRTC connection: ".concat(c.status," - ").concat(e))}console.log("Setting remote description...");let h={type:"answer",sdp:await c.text()};await n.setRemoteDescription(h),t(!0),u(!1),console.log("Successfully connected to OpenAI Realtime API")}catch(e){console.error("Connection error:",e),d(e instanceof Error?e.message:"Connection failed"),u(!1),k()}},[e,h]),k=(0,l.useCallback)(()=>{console.log("Disconnecting..."),t(!1),u(!1),n(!1),r(!1),o(""),x(!1),b.current&&(b.current.close(),b.current=null),f.current&&(f.current.close(),f.current=null),w.current&&(w.current.remove(),w.current=null),console.log("Disconnected (microphone permission preserved)")},[]),S=(0,l.useCallback)(e=>{switch(console.log("Server event:",e),e.type){case"session.created":console.log("Session created");break;case"input_audio_buffer.speech_started":console.log("Speech started"),m&&n(!0);break;case"input_audio_buffer.speech_stopped":console.log("Speech stopped"),m&&n(!1);break;case"response.audio_transcript.delta":{let t=e.delta;(null==t?void 0:t.text)&&(console.log("Transcript delta:",t.text),o(e=>e+t.text));break}case"response.audio_transcript.done":console.log("Transcript done"),m&&r(!1);break;case"response.done":console.log("Response done"),m&&r(!1);break;case"error":console.error("Server error:",e),d(e.message||"An error occurred")}},[m]),C=(0,l.useCallback)(()=>{if(!e||!f.current){console.error("Cannot start listening: not connected to Realtime API"),d("Not connected to Realtime API. Please try reconnecting.");return}console.log("Starting to listen..."),x(!0),j.current&&(j.current.enabled=!0,console.log("Microphone enabled")),n(!0),o("")},[e]),A=(0,l.useCallback)(()=>{console.log("Stopping listening..."),j.current&&(j.current.enabled=!1,console.log("Microphone disabled")),n(!1)},[]),E=(0,l.useCallback)(t=>{if(!e||!f.current){console.error("Cannot send message: not connected to Realtime API"),d("Not connected to Realtime API. Please try reconnecting.");return}console.log("Sending text message:",t),x(!0),f.current.send(JSON.stringify({type:"conversation.item.create",item:{type:"message",role:"user",content:[{type:"input_text",text:t}]}})),f.current.send(JSON.stringify({type:"response.create",response:{modalities:["text","audio"]}}))},[e]);return(0,l.useEffect)(()=>()=>{v.current&&(v.current.getTracks().forEach(e=>e.stop()),v.current=null),j.current=null,k()},[k]),{isConnected:e,isListening:s,isSpeaking:a,transcript:i,error:c,connect:y,disconnect:k,startListening:C,stopListening:A,sendTextMessage:E,userActivated:m,hasMicrophonePermission:p}};var x=s(5196),p=s(5273),g=s(5690),b=s(2138),f=s(6785);let w=e=>{let{userId:t,level:s,onLevelComplete:a,onSessionEnd:r}=e,[i,o]=(0,l.useState)(null),[d,h]=(0,l.useState)(""),[u,m]=(0,l.useState)(!0),[w,v]=(0,l.useState)(!1),[j,N]=(0,l.useState)(null),[y,k]=(0,l.useState)(!1),[S,C]=(0,l.useState)({completed:0,total:0}),[A,E]=(0,l.useState)(null),[L,R]=(0,l.useState)(!1),[T,P]=(0,l.useState)(null),[O,_]=(0,l.useState)(0),[I,D]=(0,l.useState)(!1),[M,U]=(0,l.useState)(null),F=(0,l.useRef)(null);(0,l.useEffect)(()=>{W()},[s]);let W=async()=>{try{let e=await fetch("".concat("http://localhost:3001","/session/start"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,level:s})});if(e.ok){let t=await e.json();P(t.sessionId),z()}}catch(e){console.error("Error starting session:",e)}},z=async()=>{m(!0),N(null),k(!1),h("");try{let e="http://localhost:3001",n=await fetch("".concat(e,"/lessons/random/").concat(s,"/").concat(t)),l=await n.json();if(l.levelCompleted){D(!0),U(l.nextLevel),a&&a(s,l.nextLevel);return}o(l.lesson),C(l.progress),E(l.audioUrl?"".concat(e).concat(l.audioUrl):null)}catch(e){console.error("Error loading lesson:",e)}finally{m(!1)}},J=async()=>{if(i&&d.trim()){v(!0);try{let e=await fetch("".concat("http://localhost:3001","/lessons/submit"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:t,level:s,lessonId:i.id,userAnswer:d.trim()})}),n=await e.json();N(n.feedback),k(!0),C(n.progress),_(e=>e+1)}catch(e){console.error("Error submitting answer:",e)}finally{v(!1)}}},Y=()=>{z()},K=async()=>{if(T)try{await fetch("".concat("http://localhost:3001","/session/end"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sessionId:T,lessonsCompleted:O})})}catch(e){console.error("Error ending session:",e)}r&&r(O)};return I?(0,n.jsx)("div",{className:"min-h-[100dvh] bg-black text-white flex flex-col items-center justify-center p-6",children:(0,n.jsxs)("div",{className:"text-center space-y-6 max-w-md",children:[(0,n.jsx)("div",{className:"w-20 h-20 mx-auto bg-green-500/20 rounded-full flex items-center justify-center",children:(0,n.jsx)(x.A,{className:"w-10 h-10 text-green-400"})}),(0,n.jsx)("h2",{className:"text-2xl font-bold",children:"\uD83C\uDF89 Level Complete!"}),(0,n.jsx)("p",{className:"text-white/70",children:M?"You completed all ".concat(s.toUpperCase()," lessons! Ready for ").concat(M.toUpperCase(),"?"):"Congratulations! You completed all available levels!"}),(0,n.jsxs)("div",{className:"space-y-3",children:[M&&(0,n.jsxs)("button",{onClick:()=>null==a?void 0:a(s,M),className:"w-full bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-lg font-medium transition-colors",children:["Continue to ",M.toUpperCase()]}),(0,n.jsx)("button",{onClick:K,className:"w-full bg-white/10 hover:bg-white/20 text-white py-3 px-6 rounded-lg font-medium transition-colors",children:"End Session"})]})]})}):u?(0,n.jsx)("div",{className:"min-h-[100dvh] bg-black text-white flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center space-y-4",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin mx-auto"}),(0,n.jsx)("p",{className:"text-white/60",children:"Loading lesson..."})]})}):(0,n.jsxs)("div",{className:"min-h-[100dvh] bg-black text-white flex flex-col",children:[(0,n.jsxs)("div",{className:"p-4 border-b border-white/10",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,n.jsx)("span",{className:"text-sm text-white/60",children:"Progress"}),(0,n.jsxs)("span",{className:"text-sm font-medium",children:[S.completed,"/",S.total]})]}),(0,n.jsx)("div",{className:"w-full bg-white/10 rounded-full h-2",children:(0,n.jsx)("div",{className:"bg-blue-500 h-2 rounded-full transition-all duration-300",style:{width:"".concat(S.completed/S.total*100,"%")}})})]}),(0,n.jsxs)("div",{className:"flex-1 p-6 space-y-6",children:[A&&(0,n.jsxs)("div",{className:"text-center space-y-4",children:[(0,n.jsx)("button",{onClick:()=>{F.current&&(F.current.play(),R(!0))},disabled:L,className:"w-16 h-16 bg-blue-500 hover:bg-blue-600 disabled:bg-blue-500/50 rounded-full flex items-center justify-center transition-colors",children:L?(0,n.jsx)(p.A,{className:"w-6 h-6"}):(0,n.jsx)(g.A,{className:"w-6 h-6 ml-1"})}),(0,n.jsx)("p",{className:"text-white/60 text-sm",children:"Listen to the audio and type what you hear"}),(0,n.jsx)("audio",{ref:F,src:A,onEnded:()=>{R(!1)},onPlay:()=>R(!0),onPause:()=>R(!1)})]}),!y&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsx)("textarea",{value:d,onChange:e=>h(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),y?Y():J())},placeholder:"Type what you heard...",className:"w-full bg-white/10 border border-white/20 rounded-lg p-4 text-white placeholder:text-white/50 focus:outline-none focus:border-blue-500 resize-none",rows:3,disabled:w}),(0,n.jsx)("button",{onClick:J,disabled:!d.trim()||w,className:"w-full bg-blue-500 hover:bg-blue-600 disabled:bg-blue-500/50 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:w?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"w-4 h-4 border-2 border-white/20 border-t-white rounded-full animate-spin"}),"Checking..."]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(x.A,{className:"w-4 h-4"}),"Submit Answer"]})})]}),y&&j&&(0,n.jsxs)("div",{className:"space-y-4",children:[(0,n.jsxs)("div",{className:"bg-white/10 border border-white/20 rounded-lg p-4",children:[(0,n.jsx)("h3",{className:"font-medium mb-2",children:"Feedback:"}),(0,n.jsx)("p",{className:"text-white/90",children:j})]}),(0,n.jsxs)("button",{onClick:Y,className:"w-full bg-green-500 hover:bg-green-600 text-white py-3 px-6 rounded-lg font-medium transition-colors flex items-center justify-center gap-2",children:[(0,n.jsx)(b.A,{className:"w-4 h-4"}),"Continue"]})]})]}),(0,n.jsx)("div",{className:"p-4 border-t border-white/10",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-white/60",children:[(0,n.jsx)(c.A,{className:"w-4 h-4"}),(0,n.jsxs)("span",{className:"text-sm",children:["Level ",s.toUpperCase()]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2 text-white/60",children:[(0,n.jsx)(f.A,{className:"w-4 h-4"}),(0,n.jsxs)("span",{className:"text-sm",children:[O," completed"]})]})]})})]})};var v=s(3109);let j=e=>{let{userId:t,onLevelSelect:s,onBack:a}=e,[r,i]=(0,l.useState)([]),[o,d]=(0,l.useState)(null),[h,u]=(0,l.useState)({}),[m,x]=(0,l.useState)(!0);(0,l.useEffect)(()=>{p()},[]);let p=async()=>{try{let e="http://localhost:3001",s=await fetch("".concat(e,"/lessons/levels")),n=await s.json();i(n.levels);let a=await fetch("".concat(e,"/progress/").concat(t));if(a.ok){let e=await a.json();d(e)}let l=n.levels.map(async t=>{let s=await fetch("".concat(e,"/lessons/stats/").concat(t));if(s.ok){let e=await s.json();return[t,e]}return[t,null]}),r=await Promise.all(l),o=Object.fromEntries(r.filter(e=>{let[t,s]=e;return null!==s}));u(o)}catch(e){console.error("Error loading levels and progress:",e)}finally{x(!1)}},b=e=>{var t;if(!o)return{completed:0,total:0,accuracy:0};let s=o.progress.find(t=>t.level===e),n=(null==(t=h[e])?void 0:t.total)||0;return{completed:(null==s?void 0:s.completedLessons)||0,total:n,accuracy:(null==s?void 0:s.avgAccuracy)||0}},w=e=>{if("a1"===e)return!0;let t=r.indexOf(e),s=r[t-1];if(!s)return!0;let n=b(s);return n.completed>=n.total},j=e=>{let t=b(e),s=t.total>0?t.completed/t.total*100:0;return 100===s?"from-green-500 to-green-600":s>=50?"from-blue-500 to-blue-600":s>0?"from-yellow-500 to-yellow-600":"from-gray-500 to-gray-600"};return m?(0,n.jsx)("div",{className:"min-h-[100dvh] bg-black text-white flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center space-y-4",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-2 border-white/20 border-t-white rounded-full animate-spin mx-auto"}),(0,n.jsx)("p",{className:"text-white/60",children:"Loading levels..."})]})}):(0,n.jsxs)("div",{className:"min-h-[100dvh] bg-black text-white flex flex-col",children:[(0,n.jsx)("div",{className:"p-6 border-b border-white/10",children:(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("h1",{className:"text-2xl font-bold",children:"Choose Your Level"}),(0,n.jsx)("p",{className:"text-white/60 mt-1",children:"Select your English proficiency level"})]}),a&&(0,n.jsx)("button",{onClick:a,className:"p-2 text-white/60 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:"← Back"})]})}),(0,n.jsx)("div",{className:"flex-1 p-6",children:(0,n.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:r.map(e=>{let t=b(e),a=w(e),l=t.completed>=t.total&&t.total>0;return(0,n.jsxs)("div",{className:"relative p-6 rounded-lg border transition-all duration-200 ".concat(a?"border-white/20 hover:border-white/40 cursor-pointer":"border-white/10 opacity-50 cursor-not-allowed"),onClick:()=>a&&s(e),children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)(c.A,{className:"w-5 h-5"}),(0,n.jsx)("span",{className:"text-lg font-semibold",children:e.toUpperCase()})]}),l&&(0,n.jsx)("div",{className:"w-6 h-6 bg-green-500 rounded-full flex items-center justify-center",children:(0,n.jsx)("span",{className:"text-xs",children:"✓"})})]}),(0,n.jsxs)("div",{className:"mb-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between text-sm mb-2",children:[(0,n.jsx)("span",{className:"text-white/60",children:"Progress"}),(0,n.jsxs)("span",{className:"font-medium",children:[t.completed,"/",t.total]})]}),(0,n.jsx)("div",{className:"w-full bg-white/10 rounded-full h-2",children:(0,n.jsx)("div",{className:"h-2 rounded-full transition-all duration-300 bg-gradient-to-r ".concat(j(e)),style:{width:"".concat(t.total>0?t.completed/t.total*100:0,"%")}})})]}),(0,n.jsxs)("div",{className:"space-y-2 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 text-white/60",children:[(0,n.jsx)(f.A,{className:"w-4 h-4"}),(0,n.jsxs)("span",{children:[t.total," lessons"]})]}),t.accuracy>0&&(0,n.jsxs)("div",{className:"flex items-center gap-2 text-white/60",children:[(0,n.jsx)(v.A,{className:"w-4 h-4"}),(0,n.jsxs)("span",{children:[Math.round(100*t.accuracy),"% accuracy"]})]})]}),a&&(0,n.jsxs)("button",{className:"w-full mt-4 py-2 px-4 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ".concat(l?"bg-green-500 hover:bg-green-600 text-white":"bg-blue-500 hover:bg-blue-600 text-white"),children:[(0,n.jsx)(g.A,{className:"w-4 h-4"}),l?"Review":"Start"]}),!a&&(0,n.jsx)("div",{className:"absolute inset-0 bg-black/50 rounded-lg flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsx)("div",{className:"w-8 h-8 border-2 border-white/20 rounded-full mx-auto mb-2"}),(0,n.jsx)("p",{className:"text-white/60 text-sm",children:"Complete previous level"})]})})]},e)})})}),o&&(0,n.jsx)("div",{className:"p-6 border-t border-white/10",children:(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-4 text-center",children:[(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-blue-400",children:o.progress.reduce((e,t)=>e+t.completedLessons,0)}),(0,n.jsx)("div",{className:"text-white/60 text-sm",children:"Total Completed"})]}),(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"text-2xl font-bold text-green-400",children:o.finishedLevels.length}),(0,n.jsx)("div",{className:"text-white/60 text-sm",children:"Levels Finished"})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)("div",{className:"text-2xl font-bold text-yellow-400",children:[o.progress.length>0?Math.round(o.progress.reduce((e,t)=>e+(t.avgAccuracy||0),0)/o.progress.length*100):0,"%"]}),(0,n.jsx)("div",{className:"text-white/60 text-sm",children:"Avg Accuracy"})]})]})})]})},N=e=>{let{className:t=""}=e,[s,a]=(0,l.useState)(!1),[x,p]=(0,l.useState)(!1),[g,b]=(0,l.useState)("Listening"),[f,v]=(0,l.useState)(""),[N,y]=(0,l.useState)([]),[k,S]=(0,l.useState)("chat"),[C,A]=(0,l.useState)(null),[E]=(0,l.useState)(()=>"user_".concat(Date.now(),"_").concat(Math.random().toString(36).substr(2,9))),{isConnected:L,isListening:R,isSpeaking:T,transcript:P,error:O,connect:_,startListening:I,stopListening:D,sendTextMessage:M,userActivated:U,hasMicrophonePermission:F}=m();(0,l.useEffect)(()=>{P&&R&&y(e=>{let t=[...e],s=t[t.length-1];return s&&"user"===s.role?s.content=P:t.push({role:"user",content:P}),t})},[P,R]);let W=async()=>{if(!L){try{await _()}catch(e){console.error("Failed to connect:",e)}return}R?D():I()},z=()=>{f.trim()&&L&&(y(e=>[...e,{role:"user",content:f}]),M(f),v(""))},J=e=>{S(e),"lessons"===e&&A(null)},Y=U&&(R||T);return"lessons"===k?C?(0,n.jsx)(w,{userId:E,level:C,onLevelComplete:(e,t)=>{t?A(t):(A(null),S("chat"))},onSessionEnd:e=>{A(null),S("chat")}}):(0,n.jsx)(j,{userId:E,onLevelSelect:e=>{A(e)},onBack:()=>S("chat")}):(0,n.jsxs)("div",{className:"min-h-[100dvh] h-[100dvh] bg-black text-white flex flex-col ".concat(t),children:[s&&(0,n.jsx)("div",{className:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm transition-opacity duration-300",onClick:()=>a(!1)}),(0,n.jsx)("div",{className:"fixed inset-y-0 left-0 z-50 w-3/4 sm:w-80 bg-black border-r border-white/20 transform transition-transform duration-300 ".concat(s?"translate-x-0":"-translate-x-full"),children:(0,n.jsxs)("div",{className:"p-6",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,n.jsx)("h2",{className:"text-xl font-bold text-white",children:"Menu"}),(0,n.jsx)("button",{onClick:()=>a(!1),className:"p-2 text-white/70 hover:text-white hover:bg-white/10 rounded-lg transition-colors",children:(0,n.jsx)(r.A,{className:"h-5 w-5"})})]}),(0,n.jsx)("div",{className:"space-y-2",children:["Sign In","Progress"].map(e=>(0,n.jsx)("button",{className:"block w-full text-left text-white/80 hover:text-white py-3 px-4 rounded-lg hover:bg-white/10 transition-colors duration-200",onClick:()=>a(!1),children:e},e))})]})}),(0,n.jsxs)("div",{className:"flex items-center justify-between px-4 py-3 bg-black border-b border-white/10",children:[(0,n.jsx)("button",{onClick:()=>a(!0),className:"p-2 text-white hover:bg-white/10 rounded-lg transition-colors duration-200",children:(0,n.jsx)(i.A,{className:"h-5 w-5"})}),(0,n.jsxs)("div",{className:"flex items-center bg-white/10 rounded-lg p-1",children:[(0,n.jsxs)("button",{onClick:()=>J("chat"),className:"px-3 py-1 rounded-md text-sm font-medium transition-colors flex items-center gap-2 ".concat("chat"===String(k)?"bg-white text-black":"text-white/70 hover:text-white"),children:[(0,n.jsx)(o.A,{className:"h-4 w-4"}),"Chat"]}),(0,n.jsxs)("button",{onClick:()=>J("lessons"),className:"px-3 py-1 rounded-md text-sm font-medium transition-colors flex items-center gap-2 ".concat("lessons"===String(k)?"bg-white text-black":"text-white/70 hover:text-white"),children:[(0,n.jsx)(c.A,{className:"h-4 w-4"}),"Lessons"]})]}),(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)(e=>{let{isActive:t}=e;return(0,n.jsx)("img",{src:"/realtime-indicator.png",alt:"Realtime status",className:"w-12 h-12 transition-all duration-300 ".concat(t?"grayscale-0":"grayscale")})},{isActive:Y})})]}),(0,n.jsxs)("div",{className:"flex-1 bg-black overflow-hidden",children:[O&&(0,n.jsx)("div",{className:"p-4 bg-red-500/20 border-b border-red-500/30",children:(0,n.jsx)("p",{className:"text-red-400 text-sm",children:O})}),0===N.length?(0,n.jsx)("div",{className:"h-full flex items-center justify-center",children:(0,n.jsxs)("div",{className:"text-center space-y-4 px-4",children:[(0,n.jsx)("div",{className:"w-16 h-16 mx-auto bg-white/5 rounded-full flex items-center justify-center",children:(0,n.jsx)("div",{className:"w-8 h-8 bg-white/10 rounded-full"})}),(0,n.jsx)("p",{className:"text-white/60 text-sm",children:F?"Click the voice button to start a conversation":"Click the voice button to grant microphone permission and start"})]})}):(0,n.jsxs)("div",{className:"h-full overflow-y-auto p-4 space-y-4",children:[N.map((e,t)=>(0,n.jsx)("div",{className:"flex ".concat("user"===e.role?"justify-end":"justify-start"),children:(0,n.jsx)("div",{className:"max-w-[80%] px-4 py-2 rounded-lg ".concat("user"===e.role?"bg-white/20 text-white":"bg-white/10 text-white/90"),children:(0,n.jsx)("p",{className:"text-sm",children:e.content})})},t)),R&&(0,n.jsx)("div",{className:"flex justify-end",children:(0,n.jsx)("div",{className:"max-w-[80%] px-4 py-2 rounded-lg bg-white/20 text-white",children:(0,n.jsx)("p",{className:"text-sm italic",children:"Listening..."})})}),T&&(0,n.jsx)("div",{className:"flex justify-start",children:(0,n.jsx)("div",{className:"max-w-[80%] px-4 py-2 rounded-lg bg-white/10 text-white/90",children:(0,n.jsx)("p",{className:"text-sm italic",children:"Speaking..."})})})]})]}),x&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"fixed inset-0 z-30",onClick:()=>p(!1)}),(0,n.jsx)("div",{className:"absolute bottom-20 left-4 z-40 w-48 bg-black/95 backdrop-blur-sm border border-white/20 rounded-lg shadow-lg p-2 animate-in fade-in-0 zoom-in-95 duration-200",children:(0,n.jsx)("div",{className:"space-y-1",children:["Listening","Reading","Speaking","Writing"].map(e=>(0,n.jsx)("button",{className:"w-full text-left px-3 py-2 rounded-lg transition-colors duration-200 ".concat(g===e?"bg-white/20 text-white":"text-white/70 hover:bg-white/10 hover:text-white"),onClick:()=>{b(e),p(!1)},children:e},e))})})]}),(0,n.jsx)("div",{className:"p-4 bg-black",children:(0,n.jsx)("div",{className:"bg-white/10 backdrop-blur-sm rounded-2xl shadow-lg border border-white/20 p-3",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("button",{onClick:()=>p(!x),className:"p-2 text-white hover:bg-white/10 rounded-lg transition-colors duration-200 shrink-0",children:(0,n.jsx)(d.A,{className:"h-5 w-5"})}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)("input",{value:f,onChange:e=>v(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),z())},placeholder:"Ask anything",className:"w-full bg-transparent text-white placeholder:text-white/50 focus:outline-none py-2 px-2",disabled:!L})}),(0,n.jsxs)("div",{className:"flex items-center gap-2 shrink-0",children:[f.trim()&&(0,n.jsx)("button",{onClick:z,disabled:!L,className:"p-2 text-white hover:bg-white/10 rounded-lg transition-colors duration-200 disabled:opacity-50",children:(0,n.jsx)(h.A,{className:"h-5 w-5"})}),(0,n.jsx)("button",{className:"p-2 text-white hover:bg-white/10 rounded-lg transition-colors duration-200",disabled:!L,children:(0,n.jsx)(u.A,{className:"h-5 w-5"})}),(0,n.jsx)("button",{className:"p-3 rounded-full transition-all duration-200 ".concat(Y?"bg-white text-black hover:bg-white/90":"bg-white/20 text-white hover:bg-white/30"),onClick:W,disabled:!1,children:(0,n.jsx)("div",{className:"w-2 h-2 rounded-full bg-current"})})]})]})})})]})};var y=s(3904),k=s(4449);let S=()=>{let[e,t]=(0,l.useState)({isUpdateAvailable:!1,isUpdating:!1,registration:null,isOnline:"undefined"==typeof navigator||navigator.onLine,cacheVersion:null});return(0,l.useEffect)(()=>{if(!("serviceWorker"in navigator))return;let s=()=>{let s=e.registration;if(!s)return;let n=s.installing;n&&n.addEventListener("statechange",()=>{"installed"===n.state&&navigator.serviceWorker.controller&&t(e=>({...e,isUpdateAvailable:!0}))})},n=()=>{t(e=>({...e,isUpdating:!0})),window.location.reload()},a=()=>{t(e=>({...e,isOnline:navigator.onLine}))};return navigator.serviceWorker.getRegistration().then(e=>{if(e&&(t(t=>({...t,registration:e})),e.update(),e.addEventListener("updatefound",s),navigator.serviceWorker.addEventListener("controllerchange",n),e.active)){let s=new MessageChannel;s.port1.onmessage=e=>{e.data&&e.data.version&&t(t=>({...t,cacheVersion:e.data.version}))},e.active.postMessage({type:"GET_VERSION"},[s.port2])}}),window.addEventListener("online",a),window.addEventListener("offline",a),()=>{e.registration&&e.registration.removeEventListener("updatefound",s),navigator.serviceWorker.removeEventListener("controllerchange",n),window.removeEventListener("online",a),window.removeEventListener("offline",a)}},[]),{...e,updateApp:()=>{e.registration&&e.registration.waiting?e.registration.waiting.postMessage({type:"SKIP_WAITING"}):window.location.reload()},dismissUpdate:()=>{t(e=>({...e,isUpdateAvailable:!1}))},checkForUpdates:()=>{e.registration&&e.registration.update()}}},C=()=>{let{isUpdateAvailable:e,updateApp:t,dismissUpdate:s,isOnline:a,cacheVersion:l}=S();return!e&&a?null:(0,n.jsxs)("div",{className:"fixed top-4 right-4 z-50 space-y-2",children:[e&&(0,n.jsx)("div",{className:"bg-black/95 backdrop-blur-sm border border-white/20 rounded-lg shadow-lg p-4 max-w-sm animate-in slide-in-from-top-2 duration-300",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(y.A,{className:"h-5 w-5 text-blue-400"})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-white",children:"New version available"}),(0,n.jsx)("p",{className:"text-xs text-white/60 mt-1",children:"Tap to refresh and get the latest features"})]}),(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[(0,n.jsx)("button",{onClick:t,className:"px-3 py-1.5 bg-blue-500 hover:bg-blue-600 text-white text-xs font-medium rounded-md transition-colors duration-200",children:"Refresh"}),(0,n.jsx)("button",{onClick:s,className:"p-1 text-white/60 hover:text-white hover:bg-white/10 rounded transition-colors duration-200",children:(0,n.jsx)(r.A,{className:"h-4 w-4"})})]})]})}),!a&&(0,n.jsx)("div",{className:"bg-orange-500/95 backdrop-blur-sm border border-orange-400/20 rounded-lg shadow-lg p-4 max-w-sm animate-in slide-in-from-top-2 duration-300",children:(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)("div",{className:"flex-shrink-0",children:(0,n.jsx)(k.A,{className:"h-5 w-5 text-white"})}),(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,n.jsx)("p",{className:"text-sm font-medium text-white",children:"You're offline"}),(0,n.jsx)("p",{className:"text-xs text-white/80 mt-1",children:"Some features may be limited"})]})]})}),!1]})};function A(){return(0,n.jsxs)("div",{className:"min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-slate-900",children:[(0,n.jsx)(C,{}),(0,n.jsx)(a.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:(0,n.jsx)(N,{})})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[680,441,684,358],()=>t(3930)),_N_E=e.O()}]);